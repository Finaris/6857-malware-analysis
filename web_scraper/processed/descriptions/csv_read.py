import requests
import time
import csv
import random

range_start = 0
range_end = 0

if range_end == 0:
	print("SET YOUR OWN RANGE_START AND RANGE_END")
	print("Daniel is running 0 - 500,000")
	print("Jessica is running 500,000 - 750,000")
	exit()

api_key = "INSERT_YOUR_API_KEY"
if "API" in api_key:
	print("PLEASE INSERT YOUR API KEY")
	exit()

with open('hashes.csv') as filename:
	csv_reader = csv.reader(filename, delimiter = ',')
	csv_list = list(csv_reader)

	with open('hash_response.csv', 'r') as f:
		temp_reader = csv.reader(f, delimiter = ',')
		temp_list = list(temp_reader)
		existing_set = set([x[0] for x in temp_list])

	print('existing set:', existing_set)

	index_list = list(range(range_start, range_end))
	random.shuffle(index_list)
	for index in index_list:
		i, md, sha, url = csv_list[index]
		if i in existing_set:
			break
		if md:
			resource = md
		if sha:
			resource = sha
		params = {'apikey': api_key, 'resource': resource}
		headers = {
		  "Accept-Encoding": "gzip, deflate",
		  "User-Agent" : "gzip,  request"
		  }
		response = requests.get('https://www.virustotal.com/vtapi/v2/file/report',
		  params=params, headers=headers)
		json_response = response.json()

		with open('hash_response.csv', 'a') as write_file:
			writer = csv.writer(write_file)
			writer.writerow([i, md, sha, url, json_response])

		write_file.close()
		print("entry written:", i, resource)
		time.sleep(15)